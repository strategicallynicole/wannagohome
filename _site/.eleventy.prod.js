"use strict";require("dotenv").config();var cleanCSS=require("clean-css"),fs=require("fs"),pluginRSS=require("@11ty/eleventy-plugin-rss"),localImages=require("eleventy-plugin-local-images"),lazyImages=require("eleventy-plugin-lazyimages"),ghostContentAPI=require("@tryghost/content-api"),sass=require("./config/sass-process");module.exports=function(r){sass("./assets/_scss/main.scss","./assets/styles/main.css")};var htmlMinTransform=require("./src/transforms/html-min-transform.js"),api=new ghostContentAPI({url:process.env.GHOST_API_URL,key:process.env.GHOST_CONTENT_API_KEY,version:"v2"}),stripDomain=function(r){return r.replace(process.env.GHOST_API_URL,"")};module.exports=function(r){return r.addTransform("htmlmin",htmlMinTransform),r.addPlugin(pluginRSS),r.addPlugin(localImages,{distPath:"dist",assetPath:"/assets/images",selector:"img",attribute:"data-src",verbose:!1}),r.addFilter("cssmin",function(r){return new cleanCSS({}).minify(r).styles}),r.addFilter("getReadingTime",function(r){var e=r.split(/\s/g).length;return Math.ceil(e/200)}),r.addFilter("htmlDateString",function(r){return new Date(r).toISOString().split("T")[0]}),r.setUseGitIgnore(!1),r.addCollection("docs",function(e){return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(api.pages.browse({include:"authors",limit:"all"}).catch(function(r){console.error(r)}));case 2:return(e=r.sent).map(function(r){return r.url=stripDomain(r.url),r.primary_author.url=stripDomain(r.primary_author.url),r.published_at=new Date(r.published_at),r}),r.abrupt("return",e);case 5:case"end":return r.stop()}})}),r.addCollection("posts",function(e){return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(api.posts.browse({include:"tags,authors",limit:"all"}).catch(function(r){console.error(r)}));case 2:return(e=r.sent).forEach(function(r){r.url=stripDomain(r.url),r.primary_author.url=stripDomain(r.primary_author.url),r.tags.map(function(r){return r.url=stripDomain(r.url)}),r.published_at=new Date(r.published_at)}),e.sort(function(r,e){return e.featured-r.featured}),r.abrupt("return",e);case 6:case"end":return r.stop()}})}),r.addCollection("authors",function(e){var n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(api.authors.browse({limit:"all"}).catch(function(r){console.error(r)}));case 2:return e=r.sent,r.next=5,regeneratorRuntime.awrap(api.posts.browse({include:"authors",limit:"all"}).catch(function(r){console.error(r)}));case 5:return n=r.sent,e.forEach(function(e){var t;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:(t=n.filter(function(r){return r.url=stripDomain(r.url),r.primary_author.id===e.id})).length&&(e.posts=t),e.url=stripDomain(e.url);case 3:case"end":return r.stop()}})}),r.abrupt("return",e);case 8:case"end":return r.stop()}})}),r.addCollection("tags",function(e){var n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(api.tags.browse({include:"count.posts",limit:"all"}).catch(function(r){console.error(r)}));case 2:return e=r.sent,r.next=5,regeneratorRuntime.awrap(api.posts.browse({include:"tags,authors",limit:"all"}).catch(function(r){console.error(r)}));case 5:return n=r.sent,e.forEach(function(e){var t;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:(t=n.filter(function(r){return r.url=stripDomain(r.url),r.primary_tag&&r.primary_tag.slug===e.slug})).length&&(e.posts=t),e.url=stripDomain(e.url);case 3:case"end":return r.stop()}})}),r.abrupt("return",e);case 8:case"end":return r.stop()}})}),r.setBrowserSyncConfig({callbacks:{ready:function(r,e){var t=fs.readFileSync("dist/404.html");e.addMiddleware("*",function(r,e){e.write(t),e.end()})}}}),{dir:{input:"src",output:"dist"},templateFormats:["css","njk","md","txt"],htmlTemplateEngine:"njk",markdownTemplateEngine:"njk",passthroughFileCopy:!0}};